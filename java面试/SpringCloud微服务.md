# 服务拆分

## 拆分因素

+ 横向拆分

+ 纵向拆分

# 常用组件及功能

## 综述

## Eureka **服务注册与发现**

## Ribbon **客户端负载均衡**

基于HTTP和TCP的客户端的负载均衡器，通过配置服务端列表，轮询实现负载均衡

## Feign **声明式服务调用**

feign封装了ribbon，feign是一个方便的HTTP客户端，实现服务调用

## Hystrix **断路器**

如果单个服务出现问题，调用这个服务就会出现线程阻塞，此时若有大量的请求涌入，servlet容器的线程资源就会被消耗完毕，导致服务瘫痪。

Hystrix的设计原则包括
  + 资源隔离
    通过将每个依赖服务分配独立的线程池进行资源隔离，从而避免服务雪崩
  + 熔断器
    熔断器的开关能保证服务调用者在调用异常服务时，快速返回结果，避免大量的同步等待。并且熔断器能在一段时间后，继续侦测请求执行结果，提供恢复服务调用的可能
  + 命令模式

服务雪崩的应对策略
  + 流量控制
    + 网关限流
    + 用户交互限流
    + 关闭重试
  + 改进缓存模式
    + 缓存预加载
    + 同步改为异步刷新
  + 服务自动扩容
    + AWS的auto scaling
  + 服务调用者降级服务
    + 资源隔离
    + 对依赖服务进行分类
    + 不可用服务的调用快速失败
      + 超时机制
      + 熔断器
      + 降级方法

## Config **分布式配置**

## Zuul **服务网关**

### 功能

提供了`动态路由`，`监控`，`弹性负载`，`安全`等功能。

+ 安全 (`过滤器`)

  识别需要认证的资源，拒绝不符合要求的请求

+ 监控

  服务边界追踪并统计数据

+ 动态路由

  将请求动态路由到后端集群

### 核心

Zuul的核心是`一系列的filters`，过滤器的种类

+ PRE **前置**

  请求`被路由之前`调用。可用来`鉴权`、`限流`、`参数校验调整`

+ ROUTING **路由**

  请求`路由到微服务`。用于`构建发送给微服务的请求`

+ POST **后置**

  请求`路由到微服务以后`执行。可用来`为响应添加HTTP请求头`、`收集统计信息和指标`、`将响应从微服务发送给客户端`、`日志`

+ ERROR **错误**

  在其他阶段发生错误时执行



## Zipkin **链路追踪**

## Zabbix **服务监控**

